### 零基础复刻 NestJS RealWorld 后端项目：行动路线图

**我们的目标**：创建一个全新的项目，然后参照 `MaoYugit/node-express-realworld-example-app`（这个是 NestJS 版本）的代码，一步步地将用户认证、文章、评论等核心功能在我们自己的项目中实现出来。

#### 阶段一：奠定基石 (Project Setup)

这个阶段，我们只做一件事：搭建一个能跑起来的最简单的 NestJS 项目。

**第一步：安装 NestJS 命令行工具 (CLI)**
这是 NestJS 的官方脚手架，能帮你一键生成项目结构、模块、控制器等。

*   打开你的终端，运行以下命令进行全局安装：
    ```bash
    npm install -g @nestjs/cli
    ```

**第二步：创建你的新项目**
*   在你想要存放项目的文件夹里，运行：
    ```bash
    nest new my-realworld-backend 
    ```    （`my-realworld-backend` 是你的项目名，可以自定义）
*   CLI 会问你使用哪个包管理器，选择 `npm` 即可。
*   完成后，一个标准的 NestJS 项目结构就为你创建好了。

**第三步：启动并验证“Hello World”**
*   进入你的项目目录：
    ```bash
    cd my-realworld-backend
    ```
*   启动开发服务器：
    ```bash
    npm run start:dev
    ```
*   看到终端提示应用已在 `localhost:3000` 运行后，打开浏览器访问 `http://localhost:3000`。如果你看到了 "Hello World!"，恭喜你，地基打好了！

---

#### 阶段二：数据先行 (Database & User Model)

任何应用的核心都是数据。在写任何功能代码之前，我们先让项目能连接数据库，并定义好我们的第一个数据模型：用户(User)。

**第四步：集成 Prisma (ORM 工具)**
这个参考项目使用 Prisma 来和数据库交互，我们也一样。

*   安装 Prisma 依赖：
    ```bash
    npm install prisma @prisma/client
    ```

**第五步：初始化 Prisma**
*   在项目根目录运行：
    ```bash
    npx prisma init
    ```
*   这个命令会做两件事：
    1.  创建一个 `prisma` 文件夹，里面有一个 `schema.prisma` 文件。这是定义数据库模型的地方。
    2.  创建一个 `.env` 文件，里面包含了数据库的连接字符串 `DATABASE_URL`。

**第六步：定义 User 模型**
*   打开 `prisma/schema.prisma` 文件。
*   **【参照答案】**：打开参考项目的 `prisma/schema.prisma` 文件，找到 `model User { ... }` 的那部分代码。
*   **【动手操作】**：将 `User` 模型的定义**亲手敲到**你自己的 `schema.prisma` 文件里。这会让你熟悉 Prisma 的语法。

**第七步：执行数据库迁移**
*   这个命令会读取你的 `schema.prisma` 文件，并在你的数据库里创建出对应的 `User` 表。
    ```bash
    npx prisma migrate dev --name init-user-model
    ```
*   Prisma 会自动帮你创建数据库文件（如果你用的是默认的 SQLite）。

---

#### 阶段三：实现核心功能 (用户注册与登录)

这是最关键的一步，我们将实现整个应用的第一个闭环功能。

**第八步：创建用户模块 (User Module)**
*   使用 NestJS CLI 来生成模块、控制器和服务：
    ```bash
    # 生成 User 模块
    nest generate module user
    # 生成 User 服务
    nest generate service user
    # 生成 User 控制器
    nest generate controller user
    ```

**第九步：实现用户注册 (Register)**
1.  **定义 DTO (Data Transfer Object)**：在 `user` 文件夹下创建一个 `dto` 文件夹，再创建一个 `create-user.dto.ts` 文件。
    *   **【参照答案】**：参考项目里的 `register-input.model.ts`。
    *   **【动手操作】**：定义一个 `CreateUserDto` 类，包含 `username`, `email`, `password` 字段，并使用 `class-validator` 添加校验规则。
2.  **编写 Controller**：打开 `user.controller.ts`。
    *   创建一个 `register()` 方法，用来处理 `POST /users` 的请求。
    *   让这个方法接收一个 `CreateUserDto` 类型的 `body`。
    *   在方法内部，调用 `userService.createUser()`。
3.  **编写 Service**：打开 `user.service.ts`。
    *   创建一个 `createUser()` 方法。
    *   **核心逻辑**：
        *   安装 `bcrypt` (`npm install bcrypt @types/bcrypt`)。
        *   对接收到的密码进行加密 (hash)。
        *   使用 `PrismaService` (你需要自己创建并注入) 将加密后的用户信息存入数据库。

**第十步：实现用户登录 (Login)**
1.  **安装 JWT 模块**:
    ```bash
    npm install @nestjs/jwt passport-jwt @types/passport-jwt
    ```
2.  **编写 Controller**：在 `user.controller.ts` 中创建一个 `login()` 方法，处理 `POST /users/login` 请求。
3.  **编写 Service**：在 `user.service.ts` 中创建一个 `login()` 方法。
    *   **核心逻辑**：
        *   根据 email 从数据库中查找用户。
        *   如果用户存在，使用 `bcrypt.compare()` 对比密码。
        *   如果密码正确，使用 `@nestjs/jwt` 的 `JwtService` 生成一个 JWT Token 并返回。

---

#### 阶段四：添砖加瓦 (完善其他功能)

当你完成了用户注册和登录后，你就已经掌握了 NestJS 开发的核心流程！接下来，就是重复这个流程，去实现其他功能。

**第十一步：实现 Profile 功能**
*   生成 `profile` 模块、控制器、服务。
*   实现获取用户信息、关注/取关用户的接口。

**第十二步：实现 Article 功能 (最复杂)**
*   生成 `article` 模块。
*   实现文章的 **CRUD** (Create, Read, Update, Delete) 功能。
*   这会涉及到处理文章与用户（作者）之间的关系。

**第十三步：实现 Comments, Tags 等**
*   按照同样的方法，逐个实现剩余的功能。

### 如何高效地使用“参考答案”？

1.  **先尝试，再参考**：在实现每个功能前，先自己思考一下“如果是我，我会怎么设计这个接口和逻辑？”。然后动手去写，遇到问题了，再去参考答案。
2.  **禁止复制粘贴**：一定要**亲手把代码敲出来**。肌肉记忆是学习编程很重要的一环。
3.  **理解“为什么”**：看到一行代码，要问自己：“作者为什么要这么写？有没有别的方法？这种写法的优点是什么？”
4.  **善用 Git**：每完成一个小功能（比如实现注册），就进行一次 `git commit`。这样你的项目历史就会非常清晰，也方便你回顾和回滚。

这个过程就像拼乐高，一开始很慢，但当你拼完第一个小组件（用户模块）后，后面的速度会越来越快。祝你学习愉快，在编码的世界里找到乐趣！