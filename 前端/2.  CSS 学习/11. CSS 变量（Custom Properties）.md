### **第 11 课：CSS 变量（Custom Properties）**

我们即将学习一项彻底改变了原生 CSS 写法的革命性技术。在 CSS 变量出现之前，CSS 是一门完全静态的语言。如果你在一个大型项目中定义了一个主题色 `#3498db`，并且在 100 个不同的地方使用了它，当有一天需要更换主题色时，你必须手动去修改这 100 个地方。这无疑是一场噩梦。

CSS 变量（官方称之为“自定义属性”）的出现，彻底终结了这个时代。它为我们带来了原生 CSS 中一直缺失的东西：**变量**。

#### **核心思想：可复用的动态值**

CSS 变量的核心思想非常简单：**将一个值（比如一个颜色、一个尺寸）存储在一个自定义的属性中，然后在你的样式表中的多个地方引用这个属性。**

当你需要改变这个值时，你**只需要修改这个变量的定义**，所有引用它的地方都会自动、即时地更新。这极大地提升了 CSS 的可维护性、可复用性和动态性。

---

### **深度剖析**

#### **1. 声明和使用 CSS 变量**

*   **声明变量**：
    *   变量名必须以**两个连字符 `--`** 开头。
    *   它和其他 CSS 属性一样，在规则集内部声明。
    *   ```css
      :root {
        --primary-color: #3498db;
        --base-font-size: 16px;
        --card-padding: 1.5rem;
      }
      ```

*   **使用变量**：
    *   使用 `var()` 函数来读取变量的值。
    *   `var()` 函数可以接受第二个参数，作为**备用值（fallback value）**。如果第一个变量未定义，浏览器就会使用备用值。
    *   ```css
      .button {
        background-color: var(--primary-color);
        font-size: var(--base-font-size);
      }
      .card {
        padding: var(--card-padding);
        /* 如果 --card-border-color 未定义，则使用 gray */
        border: 1px solid var(--card-border-color, gray);
      }
      ```

#### **2. 全局变量 vs. 局部变量：作用域（Scope）**

这是 CSS 变量最强大的特性之一：它们**遵循标准的层叠和继承规则**，这意味着它们是有作用域的。

*   **全局变量（Global Scope）**
    *   **定义位置**：通常定义在 `:root` 伪类选择器上。`:root` 指向文档的根元素（也就是 `<html>`），所以在这里定义的变量，在整个文档的任何地方都可以访问到。这使得它成为定义全局主题（颜色、字体、间距）的最佳位置。
    *   **示例**：
        ```css
        :root {
          --main-bg-color: #f1f5f9;
        }
        body {
          background-color: var(--main-bg-color); /* 可以访问 */
        }
        ```

*   **局部变量（Local Scope）**
    *   **定义位置**：定义在任何其他选择器上（比如一个类选择器）。这个变量只能在该选择器匹配的元素及其**后代元素**中使用。
    *   **用途**：可以用来修改一个组件的局部样式，或者为一个组件的不同变体提供不同的配置。
    *   **示例**：
        ```css
        :root {
          --button-bg-color: #e0e0e0;
        }
        .button {
          background-color: var(--button-bg-color);
        }
        
        /* 定义一个局部变量，覆盖全局设置 */
        .button--primary {
          --button-bg-color: #3498db; /* 这个变量只在 .button--primary 及其子元素中生效 */
          color: white;
        }
        ```
        在这个例子中，普通的 `.button` 背景是灰色，而 `.button--primary` 的背景会变成蓝色，因为它内部的 `--button-bg-color` 变量被重新定义了。

#### **3. 配合 JavaScript 实现一键换肤**

CSS 变量最令人兴奋的应用之一，就是它们可以被 JavaScript 轻松地读取和修改。这使得实现动态主题切换（比如“暗黑模式”）变得前所未有的简单。

**CSS 部分：**
```css
/* --- 默认的亮色主题 --- */
:root {
  --bg-color: #ffffff;
  --text-color: #333333;
  --card-bg: #f0f0f0;
}

/* --- 暗黑模式的变量定义 --- */
/* 当 html 标签有 .dark-theme 类时，应用这些变量 */
html.dark-theme {
  --bg-color: #1a1a1a;
  --text-color: #e0e0e0;
  --card-bg: #2b2b2b;
}

/* --- 在整个网站中使用这些变量 --- */
body {
  background-color: var(--bg-color);
  color: var(--text-color);
  transition: background-color 0.3s, color 0.3s; /* 添加平滑过渡 */
}
.card {
  background-color: var(--card-bg);
}
```

**JavaScript 部分：**
```javascript
const themeToggleButton = document.getElementById('theme-toggle');

themeToggleButton.addEventListener('click', () => {
  // 只需要给 html 标签切换一个类
  document.documentElement.classList.toggle('dark-theme');
});
```
**工作原理**：
1.  我们预先定义好了两套变量：一套在 `:root` 中（亮色），一套在 `html.dark-theme` 中（暗色）。
2.  当 `<html>` 标签被 JavaScript 加上 `.dark-theme` 类时，由于 `html.dark-theme` 的优先级更高，它定义的变量会**覆盖** `:root` 中的同名变量。
3.  因为整个网站的颜色都依赖于这些变量，所以当变量值改变时，所有使用这些变量的元素的颜色都会**立即、自动地更新**，从而实现一键换肤。

---

### **面试焦点**

**面试官问：“CSS 变量和 Sass/Less 变量有什么核心区别？”**

> **你的回答**：“它们最核心的区别在于**编译时 vs. 运行时**。
>
> *   **Sass/Less 变量**是**预处理器变量**，它们在**编译时**（即你运行 Sass/Less 命令将 `.scss` 文件转换为 `.css` 文件时）就会被替换成固定的值。最终生成的 CSS 文件里是不存在任何变量的，只有静态的值。
> *   **CSS 变量（自定义属性）**是**原生浏览器变量**，它们在**运行时**才被解析和计算。这意味着它们是**动态的**，可以在页面加载后通过 JavaScript 或 CSS 伪类（如 `:hover`）来实时修改，并且这种修改会立即反映在页面上。
>
> 简单来说，Sass 变量是静态的，主要用于提升开发时的代码可维护性；而 CSS 变量是动态的，不仅能提升可维护性，还能直接用于实现主题切换、响应式计算等强大的运行时交互。”

**面试官问：“你是如何使用 CSS 变量来构建你的设计系统的？”**

> **你的回答**：“在构建设计系统时，CSS 变量是我的核心工具。我会使用 `:root` 来定义一套全局的**设计令牌（Design Tokens）**。这些令牌包括：
>
> 1.  **颜色体系**：`--color-primary`, `--color-secondary`, `--color-text`, `--color-border` 等。
> 2.  **字体体系**：`--font-family-base`, `--font-size-sm`, `--font-size-md`, `--line-height-base` 等。
> 3.  **间距体系**：定义一套间距单位，如 `--spacing-1: 0.25rem`, `--spacing-2: 0.5rem`...
> 4.  **其他**：如 `--border-radius`, `--box-shadow` 等。
>
> 整个项目的所有组件都必须使用这些预定义的变量，而不是硬编码的值。这样做的好处是巨大的：首先，它保证了整个 UI 的视觉一致性；其次，当需要进行全局性的设计调整（比如更换主题色或调整基础间距）时，我只需要修改 `:root` 里的几个变量，整个网站就会自动更新，极大地提高了开发和维护效率。”

---

### **实战任务**

我们来创建一个简单的个人资料卡片，并为它添加一个“主题切换”功能。

**HTML 结构:**
```html
<div class="profile-card">
  <img src="https://via.placeholder.com/100" alt="Avatar" class="profile-avatar">
  <h2 class="profile-name">Alex Doe</h2>
  <p class="profile-bio">Frontend Developer & CSS Enthusiast.</p>
  <button class="theme-toggle-btn">Toggle Theme</button>
</div>
```

**你的任务：**
1.  **定义全局变量**: 在 `:root` 中定义一套默认（亮色）主题的变量。
    *   `--card-bg-color`: 卡片背景色 (e.g., `#ffffff`)
    *   `--text-color`: 主要文字颜色 (e.g., `#333333`)
    *   `--avatar-border-color`: 头像边框颜色 (e.g., `#cccccc`)
    *   `--button-bg-color`: 按钮背景色 (e.g., `#f0f0f0`)
2.  **构建卡片样式**: 使用你定义的 CSS 变量来为 `.profile-card` 及其内部元素添加样式。
3.  **定义暗黑主题**:
    *   创建一个 `.dark-theme` 类选择器（可以加在 `.profile-card` 上）。
    *   在这个类选择器内部，**重新定义**上面所有的变量，赋予它们适合暗黑模式的值。
4.  **添加 JavaScript 交互**:
    *   编写一小段 JavaScript，使得每次点击 `.theme-toggle-btn` 按钮时，都会给 `.profile-card` 元素**添加或移除** `.dark-theme` 这个类。
    *   **(挑战)**: 给卡片和按钮的背景色、文字颜色添加 `transition` 属性，让主题切换的过程更加平滑。

这个任务将让你完整地体验从定义变量、使用变量到通过 JavaScript 动态修改变量的全过程。
