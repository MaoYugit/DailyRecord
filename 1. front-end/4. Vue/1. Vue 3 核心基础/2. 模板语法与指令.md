### **第二章：模板语法与指令**

**我们的目标：** 创建一个如下所示的课程卡片。这张卡片上的所有信息（课程名、价格、图片、库存状态、功能列表等）都将由我们的数据动态控制。

**准备工作：**

1.  打开你上一章创建的 `vue3-master-class` 项目。
2.  找到并打开 `src/App.vue` 文件。
3.  清空 `<script setup>`, `<template>`, 和 `<style>` 标签里的所有内容，我们从一张白纸开始。

**第一步：定义我们的“数据源”**

首先，我们需要在 `<script setup>` 中定义好课程卡片所需的数据。这是所有动态内容的来源。

```vue
<!-- src/App.vue -->
<script setup>
// 在 Vue 3 的 <script setup> 中，我们使用 ref 来创建响应式的数据。
// 你可以暂时把它理解为一种能被 Vue 监测到变化的“特殊变量”。
// 我们将在第三章深入讲解它。
import { ref } from 'vue'

const course = ref({
  name: 'Vue 3 大师课',
  price: 89.9,
  stock: 15,
  onSale: true,
  description: '这是一门帮助你<strong>从入门到精通</strong>Vue 3的课程。',
  image: 'https://vuejs.org/images/logo.png',
  features: [
    '核心基础',
    'Composition API',
    'Vue Router',
    'Pinia',
    '实战项目'
  ]
})
</script>

<template>
  <!-- 我们的 HTML 结构将写在这里 -->
</template>

<style>
/* 我们简单的样式将写在这里 */
</style>
```

现在，我们有了数据，接下来看如何将这些数据显示在页面上。

---

#### **2.1 模板语法基础**

**1. 文本插值 (`{{ }}`)**

这是最基础的数据绑定形式，使用双大括号 `{{ }}`，也被称为“Mustache”语法。

*   **作用：** 将数据显示为纯文本。
*   **用法：** 括号内可以放置任何 JavaScript 表达式，例如变量名、三元运算符、数学计算等。

**案例实践：** 显示我们的课程名称和价格。

```vue
<template>
  <div>
    <h1>{{ course.name }}</h1>
    <p>价格: ¥{{ course.price }}</p>
    <p>8折后价格: ¥{{ (course.price * 0.8).toFixed(2) }}</p>
  </div>
</template>
```
**效果：** 页面上会显示 "Vue 3 大师课" 和 "价格: ¥89.9" 以及计算后的价格。

**2. 原始 HTML (`v-html`)**

有时候，你的数据本身就是一段 HTML 代码。如果使用 `{{ }}`，它只会把 HTML 标签当作普通字符串显示出来。这时就需要 `v-html`。

*   **作用：** 将数据作为真实的 HTML 进行渲染。
*   **用法：** `v-html` 是一个“指令”。Vue 的指令都以 `v-` 开头，它们是 Vue 赋予 HTML 标签的特殊能力。

**案例实践：** 显示课程的详细描述。

```vue
<template>
  <div>
    <!-- ... 其他代码 ... -->
    <h2>课程描述:</h2>
    <!-- 使用 {{ }} 会把 <strong> 标签直接显示出来 -->
    <p>{{ course.description }}</p> 
    <!-- 使用 v-html 会正确渲染加粗效果 -->
    <p v-html="course.description"></p>
  </div>
</template>
```

> **大师兄提示 (面试高频点):**
> **永远不要在用户提交的内容上使用 `v-html`！**
> 在网站上动态渲染任意 HTML 是非常危险的，因为它很容易导致 **XSS (跨站脚本攻击)**。黑客可以在内容中插入 `<script>` 标签来执行恶意代码。只在内容完全受你信任，或者经过了严格后台过滤的情况下才使用 `v-html`。

---

#### **2.2 属性绑定 (`v-bind`)**

你不能在 HTML 标签的属性上使用 `{{ }}`。例如，`<img src="{{ course.image }}">` 是无效的。要动态地绑定一个或多个属性，你需要使用 `v-bind` 指令。

*   **作用：** 动态更新 HTML 元素的属性，如 `src`, `href`, `class`, `id` 等。
*   **缩写：** `v-bind:` 有一个非常常用的缩写，就是一个冒号 `:`。例如，`v-bind:src` 等同于 `:src`。

**案例实践：** 显示课程图片。

```vue
<template>
  <div>
    <!-- ... 其他代码 ... -->
    <!-- 完整写法 -->
    <img v-bind:src="course.image" v-bind:alt="course.name">
    
    <!-- 缩写 (推荐) -->
    <img :src="course.image" :alt="course.name">
  </div>
</template>
```
现在，课程的图片就能正确显示出来了。

**动态绑定多个值：**

如果一个元素需要绑定多个属性，你可以将它们放在一个对象里，然后用不带参数的 `v-bind` 一次性绑定。

```javascript
// 在 <script setup> 中
const imageAttrs = {
  src: 'https://vuejs.org/images/logo.png',
  alt: 'Vue 3 Logo'
}
```

``````html
<!-- 在 <template> 中 -->
<img v-bind="imageAttrs">
``````

---

#### **2.3 条件渲染**

根据数据的不同状态，显示或隐藏某些元素。

**1. `v-if`, `v-else`, `v-else-if`**

*   **作用：** 真正地“条件性”渲染一块内容。如果指令的表达式返回 `false`，这块内容以及它内部的组件**不会被渲染**（在 DOM 树中不存在）。
*   **用法：** `v-else` 和 `v-else-if` 必须紧跟在 `v-if` 或 `v-else-if` 元素的后面。

**案例实践：** 根据库存显示不同的状态。

```vue
<template>
  <div>
    <!-- ... 其他代码 ... -->
    <h3>库存状态:</h3>
    <p v-if="course.stock > 10">库存充足</p>
    <p v-else-if="course.stock > 0">库存紧张</p>
    <p v-else>已售罄</p>
  </div>
</template>
```
你可以尝试修改 `<script setup>` 中 `course.stock` 的值，页面会立刻响应变化。

**2. `v-show`**

*   **作用：** 也是根据条件展示元素，但它**始终会渲染**元素，只是简单地基于 CSS 的 `display` 属性进行切换。
*   **用法：** `v-show="条件"`

> **大师兄提示 (面试必考点): `v-if` vs `v-show` 的区别？**
>
> *   **实现方式:**
>     *   `v-if` 是“真正的”条件渲染。如果条件为假，它会直接将元素从 DOM 中**移除/销毁**。
>     *   `v-show` 无论条件真假，元素都会被渲染到 DOM 中，只是通过设置 CSS `display: none;` 来**隐藏**元素。
> *   **性能开销:**
>     *   `v-if` 有更高的**切换开销**（因为要创建和销毁 DOM 元素），但有更低的**初始渲染开销**（如果条件为假，则什么都不做）。
>     *   `v-show` 有更高的**初始渲染开销**（无论如何都要渲染），但有更低的**切换开销**（只是修改 CSS）。
> *   **选择场景:**
>     *   如果条件**很少改变**（例如，根据用户权限显示不同按钮），用 `v-if` 更好。
>     *   如果需要**频繁地切换**元素的显示/隐藏（例如，Tab 切换、折叠面板），用 `v-show` 性能更好。



**目标**：在课程卡片中添加一个按钮，点击它可以“显示”或“隐藏”课程的名称。

我们将按照以下步骤来完成这个功能：

1.  **添加一个新的状态**：我们需要一个变量来“记住”当前名称是应该显示还是隐藏。
2.  **添加一个方法**：这个方法用来切换上面那个变量的状态（从显示变为隐藏，反之亦然）。
3.  **在模板中应用 `v-show`**：将课程名称元素的显示与我们的新状态绑定。
4.  **添加一个按钮**：用来触发我们的切换方法。

---

**开始实践**

打开你的 `src/App.vue` 文件，我们来一步步修改。

**第一步：在 `<script setup>` 中添加状态和方法**

我们需要一个新的 `ref` 变量来控制显示/隐藏。我们叫它 `isNameVisible`，并让它初始值为 `true`（默认显示名称）。

然后，我们创建一个 `toggleNameVisibility` 函数，它的唯一作用就是将 `isNameVisible` 的值反转。

```vue
<script setup>
import { ref } from 'vue'

// 我们之前的代码
const course = ref({ /* ... */ })
const cart = ref(0)
const quantity = ref(1)

// ... addToCart 函数 ...

// --- 新增代码开始 ---

// 1. 添加一个状态，用于控制名称的显示，默认为 true (显示)
const isNameVisible = ref(true)

// 2. 添加一个方法，用于切换 isNameVisible 的值
function toggleNameVisibility() {
  isNameVisible.value = !isNameVisible.value
}

// --- 新增代码结束 ---
</script>
```

**第二步：在 `<template>` 中应用 `v-show` 和添加按钮**

现在，我们去修改模板。

1.  找到显示课程名称的 `<h1>` 标签，给它加上 `v-show="isNameVisible"` 指令。
2.  在它旁边，添加一个按钮，并使用 `@click` 来调用我们刚创建的 `toggleNameVisibility` 函数。
3.  为了让体验更好，我们可以让按钮的文字也动态变化。

```vue
<template>
  <div class="card">
    <img :src="course.image" :alt="course.name" class="course-image">
    
    <!-- 1. 在 h1 标签上应用 v-show -->
    <h1 :class="{ 'on-sale': course.onSale }" v-show="isNameVisible">
      {{ course.name }}
    </h1>
    
    <!-- 2. 添加一个按钮来触发切换方法 -->
    <!-- 我们使用了三元运算符来动态显示按钮文本 -->
    <button @click="toggleNameVisibility">
      {{ isNameVisible ? '隐藏名称' : '显示名称' }}
    </button>
    
    <!-- ... 其他模板代码保持不变 ... -->
  </div>
</template>
```

现在运行你的项目，你会看到一个新的按钮。点击它，课程名称就会神奇地消失和出现！

---

**大师兄的深度解析：打开开发者工具看本质！**

这才是本节课最精华的部分，也是面试官希望你理解的深度。

1.  在浏览器中打开你的项目页面。
2.  按下 `F12` 键（或者右键 -> 检查），打开**开发者工具**，并切换到 **Elements (元素)** 面板。
3.  找到代表课程名称的那个 `<h1>` 标签。

现在，反复点击“隐藏/显示名称”按钮，并**仔细观察 `<h1>` 标签在 Elements 面板中的变化**：

**当你点击“隐藏名称”时，你会看到：**

```html
<h1 class="on-sale" v-show="isNameVisible" style="display: none;">
  Vue 3 大师课
</h1>
```
**关键点**：`<h1>` 元素**依然存在于 DOM 树中**！Vue 只是给它动态地添加了一个内联样式 `style="display: none;"` 来把它从视觉上隐藏掉。

**当你点击“显示名称”时，你会看到：**

```html
<h1 class="on-sale" v-show="isNameVisible">
  Vue 3 大师课
</h1>
```
**关键点**：Vue 移除了那个内联样式，`<h1>` 元素就恢复了它默认的 `display` 值（在这里是 `block`），于是它又显示出来了。

**与 `v-if` 的终极对比**

现在，为了加深理解，你可以做一个小实验：**把 `v-show="isNameVisible"` 替换成 `v-if="isNameVisible"`**，然后再次观察 Elements 面板。

你会发现：

*   **当 `isNameVisible` 为 `true` 时**：`<h1>` 元素正常存在于 DOM 中。
*   **当 `isNameVisible` 为 `false` 时**：`<h1>` 元素**会彻底从 DOM 树中消失**！取而代之的是一个类似 `<!--v-if-->` 的注释占位符。

这个简单的实验，让你用自己的眼睛验证了 `v-if` 和 `v-show` 的根本区别：
*   `v-show` 是**“障眼法”**（CSS 隐藏），元素一直在那里。
*   `v-if` 是**“移形换影”**（DOM 移除/重建），元素是真的不在了。

你现在不仅学会了如何使用 `v-show`，更重要的是，你深刻理解了它和 `v-if` 在底层实现上的差异，这对于编写高性能的应用和从容应对面试至关重要。

---

#### **2.4 列表渲染 (`v-for`)**

当我们需要根据一个数组或对象来渲染一个列表时，使用 `v-for` 指令。

*   **作用：** 遍历数组或对象，为每个元素创建一块模板内容。
*   **语法：** `v-for="item in items"` 或 `v-for="(item, index) in items"`。

**案例实践：** 展示课程的功能特性列表。

```vue
<template>
  <div>
    <!-- ... 其他代码 ... -->
    <h3>课程特色:</h3>
    <ul>
      <li v-for="(feature, index) in course.features" :key="feature">
        {{ index + 1 }}. {{ feature }}
      </li>
    </ul>
  </div>
</template>
```

**关键属性：`key` (面试必考点)**

当 Vue 正在更新使用 `v-for` 渲染的元素列表时，它默认使用“就地更新”的策略。如果列表的顺序发生了变化，Vue 不会移动 DOM 元素来匹配数据项的顺序，而是简单地修改每个元素的内容。

这在某些情况下会导致问题（例如，列表项包含输入框或组件时）。为了给 Vue 一个提示，以便它能跟踪每个节点的身份，从而重用和重新排序现有元素，你需要为每项提供一个**唯一的 `key`** 属性。

*   **`key` 的值必须是唯一的字符串或数字。**

**案例实践：** 为我们的列表添加 `key`。

```vue
<template>
  <!-- ... -->
  <ul>
    <!-- 错误示范：在没有稳定ID的情况下，不推荐用 index 作为 key -->
    <!-- <li v-for="(feature, index) in course.features" :key="index"> -->

    <!-- 正确示范：因为我们的 feature 字符串本身是唯一的，这里可以用它作为 key -->
    <li v-for="feature in course.features" :key="feature">
      {{ feature }}
    </li>
  </ul>
</template>
```

> **大师兄提示：为什么不推荐用 `index` 作为 `key`？**
> 当列表发生**重新排序**或**在中间插入/删除**元素时，`index` 会改变。
> 比如 `['A', 'B', 'C']`，它们的 key 分别是 `0, 1, 2`。
> 如果我们在开头插入一个 'D'，列表变成 `['D', 'A', 'B', 'C']`，它们的 key 仍然是 `0, 1, 2, 3`。Vue 会对比新旧 VDOM，发现 key 为 0 的节点内容从 'A' 变成了 'D'，key 为 1 的从 'B' 变成了 'A'... 它会去**修改**每一个节点，而不是**移动**它们。
> 这会导致性能问题和一些奇怪的状态 bug。**只有当你的列表是纯静态展示，且永远不会改变顺序时，才可以使用 `index` 作为 `key`。** 最理想的 `key` 是数据项自带的唯一 ID，比如 `item.id`。

---

#### **2.5 事件处理 (`v-on`)**

我们需要和用户进行交互，比如点击按钮。`v-on` 指令用来监听 DOM 事件。

*   **作用：** 监听 DOM 事件，并在事件触发时执行一些 JavaScript 代码或方法。
*   **缩写：** `@`。例如，`v-on:click` 等同于 `@click`。

**案例实践：** 添加一个“加入购物车”按钮。

1.  在 `<script setup>` 中，添加购物车数量和一个方法。
    ```javascript
    import { ref } from 'vue'
    
    const course = ref({ /* ... */ })
    const cart = ref(0) // 购物车商品数量
    
    function addToCart() {
      if (course.value.stock > 0) {
        cart.value++
        course.value.stock--
      }
    }
    ```
    *注意：在 `<script>` 部分访问 `ref` 创建的变量时，需要通过 `.value`。但在 `<template>` 中 Vue 会自动“解包”，所以可以直接用 `course.stock`。*

2.  在 `<template>` 中添加按钮并绑定事件。
    ```vue
    <template>
      <div>
        <!-- ... 其他代码 ... -->
        <p>购物车数量: {{ cart }}</p>
    
        <!-- 只有在有库存时才显示按钮 -->
        <button v-if="course.stock > 0" @click="addToCart">
          加入购物车
        </button>
        <!-- 库存为0时，按钮禁用 -->
        <button v-else :disabled="true">
          已售罄
        </button>
      </div>
    </template>
    ```

**事件修饰符**

Vue 提供了一些事件修饰符来处理事件的常见细节，而无需在方法中编写复杂的逻辑。

*   `.stop`: 阻止事件冒泡。等同于 `event.stopPropagation()`。
*   `.prevent`: 阻止元素的默认行为。等同于 `event.preventDefault()`。
*   `.self`: 只当事件在该元素本身（而不是子元素）触发时，才会触发回调。
*   `.once`: 事件将只触发一次。

**案例：** `@click.stop="doSomething"`

**按键修饰符**

在监听键盘事件时，我们经常需要检查特定的按键。

*   `@keyup.enter`: 按下回车键时触发。
*   `@keydown.tab`: 按下 Tab 键时触发。

---

#### **2.6 Class 与 Style 绑定**

为了让界面更好看，我们需要动态地改变元素的样式。

**1. 动态切换 Class**

你可以通过 `:class` (即 `v-bind:class`) 来动态地添加或移除 CSS 类名。它支持对象语法和数组语法。

*   **对象语法 (最常用):** `{ '类名': 布尔值 }`。当布尔值为 `true` 时，该类名被应用。

**案例实践：** 当课程在打折时，给标题添加一个特殊的 `on-sale` 类。

1.  在 `<style>` 中添加样式：
    ```css
    .on-sale {
      color: red;
      font-weight: bold;
    }
    ```2.  在 `<template>` 中使用对象语法绑定 class：
    ```vue
    <template>
      <div>
        <h1 :class="{ 'on-sale': course.onSale }">{{ course.name }}</h1>
        <!-- ... -->
      </div>
    </template>
    ```
    因为 `course.onSale` 是 `true`，所以 `<h1>` 会被添加 `on-sale` 类，文字变成红色粗体。

**2. 绑定内联样式**

使用 `:style` 可以绑定内联样式。它也支持对象语法。

*   **对象语法：** `:style="{ css属性名: '值' }"`。注意 CSS 属性名要用驼峰式 (`fontSize`) 或用引号括起来的短横线分隔式 (`'font-size'`)。

**案例实践：** 动态设置价格的颜色。

```vue
<template>
  <div>
    <!-- ... -->
    <p :style="{ color: course.onSale ? 'red' : 'black', fontSize: '20px' }">
      价格: ¥{{ course.price }}
    </p>
    <!-- ... -->
  </div>
</template>
```

---

#### **2.7 表单输入绑定 (`v-model`)**

`v-model` 是一个非常强大的指令，它能在表单的 `<input>`, `<textarea>`, `<select>` 元素上创建**双向数据绑定**。

*   **作用：** 将表单输入的值和你的数据状态同步起来。用户输入改变，数据跟着变；数据改变，输入框里的值也跟着变。
*   **本质：** `v-model` 是一个语法糖。`v-model="data"` 基本上等同于 `:value="data" @input="event => data = event.target.value"`。

**案例实践：** 添加一个输入框，让用户可以选择购买数量。

1.  在 `<script setup>` 中添加数量数据：
    ```javascript
    const quantity = ref(1) // 购买数量，默认为1
    ```
2.  修改 `addToCart` 方法以使用这个数量：
    ```javascript
    function addToCart() {
      // 确保购买数量不超过库存
      if (course.value.stock >= quantity.value) {
        cart.value += quantity.value
        course.value.stock -= quantity.value
        quantity.value = 1 // 重置购买数量
      } else {
        alert('库存不足！')
      }
    }
    ```
3.  在 `<template>` 中添加输入框并使用 `v-model`：
    ```vue
    <template>
      <div>
        <!-- ... -->
        <label for="quantity">购买数量:</label>
        <input type="number" id="quantity" v-model="quantity" min="1">
        
        <button v-if="course.stock > 0" @click="addToCart">
          加入购物车
        </button>
        <!-- ... -->
      </div>
    </template>
    ```

**`v-model` 的修饰符**

*   `.lazy`: 默认情况下，`v-model` 在每次 `input` 事件后同步数据。使用 `.lazy` 修饰符，会转为在 `change` 事件之后再同步（即输入框失去焦点时）。
*   `.number`: 自动将用户的输入值转为数值类型。
*   `.trim`: 自动过滤用户输入的首尾空白字符。

**案例：** 改进我们的数量输入框。

```vue
<input type="number" v-model.number="quantity" min="1">
```
这样，即使输入框返回的是字符串 "1"，`v-model.number` 也会确保 `quantity` 变量的值是数字 `1`。

---

### **本章完整代码示例**

`src/App.vue`

```vue
<script setup>
import { ref } from 'vue'

const course = ref({
  name: 'Vue 3 大师课',
  price: 89.9,
  stock: 15,
  onSale: true,
  description: '这是一门帮助你<strong>从入门到精通</strong>Vue 3的课程。',
  image: 'https://vuejs.org/images/logo.png',
  features: [
    '核心基础',
    'Composition API',
    'Vue Router',
    'Pinia',
    '实战项目'
  ]
})

const cart = ref(0)
const quantity = ref(1)

function addToCart() {
  if (course.value.stock >= quantity.value) {
    cart.value += quantity.value
    course.value.stock -= quantity.value
    quantity.value = 1
  } else {
    alert('库存不足！')
  }
}
</script>

<template>
  <div class="card">
    <img :src="course.image" :alt="course.name" class="course-image">
    
    <h1 :class="{ 'on-sale': course.onSale }">{{ course.name }}</h1>
    
    <p :style="{ color: course.onSale ? 'red' : 'black', fontSize: '20px' }">
      价格: ¥{{ course.price }}
    </p>

    <h2>课程描述:</h2>
    <p v-html="course.description"></p>

    <h3>课程特色:</h3>
    <ul>
      <li v-for="feature in course.features" :key="feature">
        {{ feature }}
      </li>
    </ul>

    <h3>库存状态:</h3>
    <p v-if="course.stock > 10">库存充足 (剩余 {{ course.stock }} 件)</p>
    <p v-else-if="course.stock > 0">库存紧张 (剩余 {{ course.stock }} 件)</p>
    <p v-else>已售罄</p>
    
    <hr>
    
    <p>购物车数量: {{ cart }}</p>

    <div class="controls">
      <label for="quantity">购买数量:</label>
      <input type="number" id="quantity" v-model.number="quantity" min="1" :max="course.stock">
      
      <button v-if="course.stock > 0" @click="addToCart">
        加入购物车
      </button>
      <button v-else :disabled="true" class="disabled-button">
        已售罄
      </button>
    </div>
  </div>
</template>

<style>
.card {
  width: 400px;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 20px;
  margin: 20px;
  font-family: sans-serif;
}

.course-image {
  width: 100px;
}

.on-sale {
  color: red;
  text-decoration: line-through;
}

.disabled-button {
  background-color: #ccc;
  cursor: not-allowed;
}

.controls > * {
  margin-right: 10px;
}
</style>
```

---

**章节总结**

太棒了！你已经完成了至关重要的第二章。现在你掌握了 Vue 中最常用、最核心的模板语法和指令。你已经能够：
*   将数据渲染到页面上 (`{{ }}` 和 `v-html`)。
*   动态控制 HTML 元素的属性 (`:src`, `:class`, `:style`)。
*   根据条件决定元素是否显示 (`v-if`, `v-show`)。
*   渲染数据列表 (`v-for` 和 `:key`)。
*   响应用户的交互 (`@click`)。
*   实现表单的双向数据绑定 (`v-model`)。

你已经可以构建出功能丰富的动态界面了。在下一章，我们将深入幕后，揭开 Vue 的核心秘密——**响应式系统**，你将彻底明白 `ref` 是如何工作的，并学习更强大的 `computed` 和 `watch`。